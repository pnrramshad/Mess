
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Room Expense Tracker</title>
<style>
body {font-family:Arial,sans-serif;margin:0;padding:0;background:#6dd5fa;display:flex;flex-direction:column;align-items:center;}
#loginPage, #mainPage {width:100%; max-width:600px;}
#loginBox, .modal-content {background:#fff;padding:30px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.2);text-align:center;margin-top:50px;}
#loginBox input, .modal-content input, .modal-content select{display:block;width:100%;margin:10px 0;padding:10px;font-size:16px;}
#loginBox button, .modal-content button{padding:10px 20px;font-size:16px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer;}
#loginMsg, #userLoginMsg{color:red;}
#mainPage{display:none;padding:20px;background:#fff;border-radius:15px;margin-top:30px;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
table{width:100%;border-collapse:collapse;margin-bottom:15px;}
th,td{padding:10px;border:1px solid #ccc;text-align:center;}
th{background:#007bff;color:#fff;}
button.action-btn{padding:10px 15px;margin:5px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer;}
button.action-btn:hover{opacity:0.9;}
button.add-entry-btn{padding:12px 20px;margin-bottom:15px;background:#ff9800;color:#fff;font-weight:bold;font-size:16px;border:none;border-radius:8px;cursor:pointer;}
button.add-entry-btn:hover{opacity:0.9;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:100;}
.modal-content{width:90%;max-width:500px;color:#222;background:#fff;padding:20px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
.member-item{display:flex;justify-content:space-between;padding:8px;background:#f1f1f1;margin:5px 0;border-radius:6px;}
.member-item button{background:#e74c3c;padding:4px 8px;border:none;border-radius:6px;color:#fff;cursor:pointer;}
#calcSection, #trackSection{display:none;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
<div id="loginBox">
<h2>Login</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button id="loginBtn">Login</button>
<p id="loginMsg"></p>
</div>
</div>

<!-- MAIN PAGE -->
<div id="mainPage">
<h2>üè† Room Expense Tracker</h2>

<!-- Rent Display -->
<div id="rentValue" style="text-align:center;margin-bottom:10px;">Room Rent: 0 AED</div>

<!-- Special Add Entry Button -->
<button class="add-entry-btn" id="addEntryBtn">‚ûï Add Entry</button>

<!-- Expense Table -->
<table>
<thead>
<tr>
<th>Name</th>
<th>Date</th>
<th>Type</th>
<th>Amount</th>
</tr>
</thead>
<tbody id="expenseBody"></tbody>
</table>

<!-- Action Buttons -->
<div style="text-align:center;">
<button class="action-btn" id="editBtn">Edit Entries</button>
<button class="action-btn" id="usersBtn">Users Management</button>
<button class="action-btn" id="reportBtn">Report</button>
<button class="action-btn" id="setRentBtn">Set Rent Amount</button>
</div>

<!-- Track Expenses Section -->
<div id="trackSection">
<h3>Track Expenses</h3>
<table>
<thead>
<tr>
<th>Name</th><th>Date</th><th>Type</th><th>Amount</th>
</tr>
</thead>
<tbody id="trackBody"></tbody>
</table>
</div>

<!-- Calculation Section -->
<div id="calcSection">
<h3>Calculations</h3>
<table>
<thead>
<tr>
<th>Name</th><th>Paid</th><th>Expense Share</th><th>Rent Share</th><th>To Pay</th>
</tr>
</thead>
<tbody id="calcTableBody"></tbody>
<tfoot id="calcTableFoot"></tfoot>
</table>
</div>
</div>

<!-- Add Entry Modal -->
<div class="modal" id="entryModal">
<div class="modal-content">
<h3>Add Expense Entry</h3>
<select id="entryName"><option value="">Select Name</option></select>
<input type="date" id="entryDate">
<select id="entryType">
<option value="">Select Type</option>
<option value="Water">Water</option>
<option value="Grocery">Grocery</option>
<option value="Maintenance">Maintenance</option>
<option value="Others">Others</option>
</select>
<input type="number" id="entryAmount" placeholder="Amount">
<button id="saveEntryBtn">Save Entry</button>
<button onclick="closeEntryModal()">Close</button>
</div>
</div>

<!-- Users Management Modal -->
<div class="modal" id="userModal">
<div class="modal-content">
<h3>Admin Login</h3>
<input type="text" id="userAdminName" placeholder="Username">
<input type="password" id="userAdminPass" placeholder="Password">
<button id="userLoginBtn">Login</button>
<p id="userLoginMsg"></p>

<!-- Roommates management -->
<div id="roommatesDiv" style="display:none;">
<h3>Roommates</h3>
<div id="roommateList"></div>
<input type="text" id="newRoommate" placeholder="Add new roommate">
<button id="addRoommateBtn">Add</button>
<button id="saveRoommatesBtn">Save</button>
<button onclick="closeUserModal()">Close</button>
</div>
</div>
</div>

<!-- Set Rent Modal -->
<div class="modal" id="rentModal">
<div class="modal-content">
<h3>Set Room Rent</h3>
<input type="number" id="rentInput" placeholder="Enter rent amount">
<button id="saveRentBtn">Save</button>
<button onclick="closeRentModal()">Close</button>
</div>
</div>

<script>
// GitHub Constants
const GITHUB_OWNER = "pnrramshad";
const GITHUB_REPO = "mess";
const GITHUB_FILE = "data.json";
const GITHUB_BRANCH = "main";
const GITHUB_TOKEN = "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";

let roommates = [];
let roomRent = 0;
let expenses = [];
let githubSha = ""; // To track file version

// ---------- GitHub Functions ----------
async function loadData(){
try{
const res = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE}?ref=${GITHUB_BRANCH}`);
if(res.status===404){
// File not exist, initialize empty
roommates = [];
expenses = [];
roomRent = 0;
githubSha = "";
saveData();
return;
}
const data = await res.json();
githubSha = data.sha;
const content = JSON.parse(atob(data.content));
roommates = content.roommates || [];
expenses = content.expenses || [];
roomRent = content.roomRent || 0;
document.getElementById("rentValue").textContent = `Room Rent: ${roomRent} AED`;
renderExpenses();
} catch(e){
console.error("Load Error:",e);
}
}

async function saveData(){
try{
const body = {
message: "Update data",
content: btoa(JSON.stringify({roommates, expenses, roomRent},null,2)),
branch: GITHUB_BRANCH
};
if(githubSha) body.sha = githubSha;
const res = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_FILE}`,{
method:"PUT",
headers:{
Authorization:`token ${GITHUB_TOKEN}`,
"Content-Type":"application/json"
},
body: JSON.stringify(body)
});
const data = await res.json();
githubSha = data.content.sha;
} catch(e){
console.error("Save Error:",e);
}
}

// ---------- LOGIN ----------
document.getElementById("loginBtn").addEventListener("click",()=>{
const user=document.getElementById("username").value.trim();
const pass=document.getElementById("password").value.trim();
if(user==="admin" && pass==="ramshad"){
document.getElementById("loginPage").style.display="none";
document.getElementById("mainPage").style.display="block";
loadData();
} else {
document.getElementById("loginMsg").textContent="‚ùå Wrong username or password!";
}
});

// ---------- ADD ENTRY ----------
document.getElementById("addEntryBtn").addEventListener("click", openEntryModal);
function openEntryModal(){
document.getElementById("entryModal").style.display="flex";
const nameSelect = document.getElementById("entryName");
nameSelect.innerHTML = '<option value="">Select Name</option>';
roommates.forEach(r=>nameSelect.innerHTML += `<option value="${r}">${r}</option>`);
document.getElementById("entryDate").value = new Date().toISOString().split('T')[0];
document.getElementById("entryType").value="";
document.getElementById("entryAmount").value="";
}
function closeEntryModal(){document.getElementById("entryModal").style.display="none";}

document.getElementById("saveEntryBtn").addEventListener("click",()=>{
const name = document.getElementById("entryName").value;
const date = document.getElementById("entryDate").value;
const type = document.getElementById("entryType").value;
const amount = parseFloat(document.getElementById("entryAmount").value);
if(!name || !date || !type || isNaN(amount)){
alert("Please fill all fields!");
return;
}
expenses.push({name,date,type,amount});
renderExpenses();
saveData(); // Save to GitHub
closeEntryModal();
});

// ---------- RENDER EXPENSES ----------
function renderExpenses(){
const tbody = document.getElementById("expenseBody");
tbody.innerHTML="";
expenses.forEach(e=>{
const tr=document.createElement("tr");
tr.innerHTML=`<td>${e.name}</td><td>${e.date}</td><td>${e.type}</td><td>${e.amount.toFixed(2)}</td>`;
tbody.appendChild(tr);
});
}

// ---------- USERS MANAGEMENT ----------
document.getElementById("usersBtn").addEventListener("click",()=>{
document.getElementById("userModal").style.display="flex";
document.getElementById("roommatesDiv").style.display="none";
document.getElementById("userAdminName").value="";
document.getElementById("userAdminPass").value="";
document.getElementById("userLoginMsg").textContent="";
});
function closeUserModal(){document.getElementById("userModal").style.display="none";}

document.getElementById("userLoginBtn").addEventListener("click",()=>{
const user=document.getElementById("userAdminName").value.trim();
const pass=document.getElementById("userAdminPass").value.trim();
if(user==="admin" && pass==="ramshad"){
document.getElementById("userLoginMsg").textContent="";
document.getElementById("roommatesDiv").style.display="block";
loadRoommates();
} else {
document.getElementById("userLoginMsg").textContent="‚ùå Wrong credentials!";
}
});

function loadRoommates(){
const listDiv=document.getElementById("roommateList");
listDiv.innerHTML="";
roommates.forEach((r,i)=>{
const div=document.createElement("div");
div.className="member-item";
div.innerHTML=`<span contenteditable="true">${r}</span>
<button onclick="deleteRoommate(${i})">Delete</button>`;
listDiv.appendChild(div);
});
}

document.getElementById("addRoommateBtn").addEventListener("click",()=>{
const newName=document.getElementById("newRoommate").value.trim();
if(newName){
roommates.push(newName);
document.getElementById("newRoommate").value="";
loadRoommates();
saveData(); // save changes
}
});

function deleteRoommate(index){
roommates.splice(index,1);
loadRoommates();
saveData(); // save changes
}

document.getElementById("saveRoommatesBtn").addEventListener("click",()=>{
const spans=document.querySelectorAll("#roommateList .member-item span");
roommates=[];
spans.forEach(s=>{if(s.textContent.trim()!=="") roommates.push(s.textContent.trim());});
alert("Roommates saved successfully!");
saveData(); // save changes
});

// ---------- RENT ----------
document.getElementById("setRentBtn").addEventListener("click",openRentModal);
function openRentModal(){
document.getElementById("rentModal").style.display="flex";
document.getElementById("rentInput").value = roomRent || "";
}
function closeRentModal(){document.getElementById("rentModal").style.display="none";}
document.getElementById("saveRentBtn").addEventListener("click",()=>{
const rent=parseFloat(document.getElementById("rentInput").value);
if(!isNaN(rent)){
roomRent=rent;
document.getElementById("rentValue").textContent=`Room Rent: ${roomRent} AED`;
closeRentModal();
alert("Room rent saved!");
saveData(); // save changes
} else alert("Enter a valid number!");
});

// ---------- REPORT ----------
document.getElementById("reportBtn").addEventListener("click",showCalculations);
function showCalculations(){
document.getElementById("trackSection").style.display="none";
document.getElementById("calcSection").style.display="block";

const totals = {};
roommates.forEach(r=>totals[r]=0);
expenses.forEach(e=>{if(totals[e.name]!==undefined) totals[e.name]+=e.amount;});

const totalExpenses = Object.values(totals).reduce((a,b)=>a+b,0);
const expenseShare = totalExpenses/roommates.length;
const rentShare = roomRent/roommates.length;

const tbody = document.getElementById("calcTableBody");
tbody.innerHTML="";
const tfoot = document.getElementById("calcTableFoot");
tfoot.innerHTML="";

roommates.forEach(r=>{
const toPay = (rentShare + expenseShare - totals[r]).toFixed(2);
const tr=document.createElement("tr");
tr.innerHTML=`<td>${r}</td><td>${totals[r].toFixed(2)}</td><td>${expenseShare.toFixed(2)}</td><td>${rentShare.toFixed(2)}</td>
<td style="font-weight:bold;color:${toPay>0?'#d9534f':'#28a745'};">${toPay}</td>`;
tbody.appendChild(tr);
});

tfoot.innerHTML=`<tr><td colspan="2">Total Expenses</td><td colspan="3">${totalExpenses.toFixed(2)} AED</td></tr>`;
}

// ---------- INIT ----------
loadData();
</script>
</body>
</html>
Zoomed out of item.